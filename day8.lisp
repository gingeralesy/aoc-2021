#|
This file is a part of aoc-2021
(c) 2021 Janne Pakarinen (gingeralesy@gmail.com)
Author: Janne Pakarinen <gingeralesy@gmail.com>
|#

(in-package #:aoc-2021)

(defparameter *day8-input* (local-file #P"day8.txt" :error T))

(defun d8-ch-to-integer (ch)
  (ecase ch (#\a 1) (#\b 2) (#\c 4) (#\d 8) (#\e 16) (#\f 32) (#\g 64)))

(defun d8-integer-to-ch (number)
  (ecase number (0 NIL) (1 #\a) (2 #\b) (4 #\c) (8 #\d) (16 #\e) (32 #\f) (64 #\g)))

(defun d8-code-to-integer (code)
  (loop with segment = 0
        for ch across code
        do (incf segment (d8-ch-to-integer ch))
        finally (return (logand segment #x7f))))

(defun d8-integer-to-code (number)
  (loop for n from 0 below 7
        for ch = (d8-integer-to-ch (logand number (ash 1 n)))
        when ch collect ch into characters
        finally (return (format NIL "泾汨狎徙翦蝮┅┅ㄤ彐躅涓溽翎ī鏖翳镳孱骈戾篝蝈犴溽腑轭瘐舄洪姝滹弩铒舡屮轶哄蝌矧戾è筱犷铄ㄣ飙痧泸搴泸遽翦筱犷铄④荀┅祜镳骘扉铄蝈徜扉铄篝蝈犴紊泰骘孱趄磲脲狎蜥贝哄戾礤铘豉疱Ж躅箝珙邃怡翦珐洪铋糸犰屐屙孱癌骘泔躅麒殪扉铄滹ㄣ飙痧泸搴滹磲翥桢蟓狍篝蜷铉磲翥筱犷铄扉铄箦翩ㄡ蝈孱趄泔躅舂ㄤ腑泔溴麸轭翦珏磲翥瑭ㄩ钽泔躅舂泔祆邈孱趄轭麸鲠祯弩骈钺祆蝈趱蝾鲠祯弩┅┅｜尼负渝鲥渝珥孱渝狎汨亠忉蝈禊蝈徙翳筢驽豉镦翳汜鲥麒孱翳麒犰箜狍桢轭麸翳汜鲥盹豸璎泔祆狃箝铉轸渝铙矧轭溟汜翦犷雉桢屮轸麸翳轶汜鲥狒眭汨珧遽翦溴痿璎箫秕栳鲥铒汨镩沐怩麸痱弩镱馏秕篚忭狎轭箪秣禊磲脲轸麽翳蝻蹒翳汜鲥簌篝屙秕铒糸沐翳狒翳骘躜溟玳箦鲥瞽箦珥孱溟箴灬轭秕篚忭狎轭狎磲戽躅泗轱铋铉翳妁眭篝栳鲥忮孱溽磲珏漉蜷铉翳弩汜疱亠酾祆忮轭祜镦趄秕忪鏖翳秕翳屙箫秕т忮趑弪骈珲蝈秕麒狒黩镱绠裴汨溟玳镦箦鲥瞽箦珥孱溟箴灬轶蝈钿弪邃怡趱蝾轭镱矧镦犷镦箦鲥箦珥孱趔钺礤翳蝻蹒绾昂焙埠澈春後後後後後後滗滗滗滗滗滗珑珑珑珑珑珑岛逗泛负购後後後後後後後後後後滗滗滗滗滗滗滗滗珑珑珑珑珑珑珑珑语麸蝈钿弪爆镱禊箦珥孱趔犷黠蹯忮趱蝾邃镱翳蝈篝黠蹯忮镦娈燥蝈钿弪番镱禊箦珥孱趔岈悻犷黠蹯忮趱蝾邃镱澡痱镡戾轶翳狒翳箝珙犰麒殂泔铘蝻翳箦珥孱趔栳鲥忮孱黹邃躔镱遽汨溟箴灬澡篚忭狎轭轶篝殪趄轭麸溟箴灬铛礅弪怡痱镤蹉轭秕麴豸镱箝珙犰鏖蝈翳蝻蹒绗怩翳矬鏖蝈狎泔铑邈翦麸箦珥孱趔蜥钿镯禊罪蝮瀣翳鏖蝈箦珥孱泔铑邈糸镱狎黹邃躔箦疳蜥翦禊骘遽汨骘躜溟玳溟箴灬领镦翳溟玳趔鏖翳轭溟箴灬躞翳筢礤泔铑邈糸镱蟋翳秕玷语秕黹玷腩秣翳狒镱禊箝珙犰鏖蝈犷狎趱蝾邃镱怩翳狒滹弩瞌礤犷箦珥孱趔犷狎趱蝾邃镱翳镱禊溟玳翳狒躞弩赭箦珥孱趔轶爆箫轸眭篝礤犷箦珥孱趔犷狎礤犷麸忮镱组翳牾篝翳狒轭骘蝽狒轱瞵秕篝殪汜瞌翦祆麒殂鏖蝈ㄢ绌顼弩麸麒殂箦珥孱ㄣ姗骑翳狒秕ъ铄邃麸泔祆邈盹蝈轭骘蝽狒轱町骑遽汨溟箴灬秕麽翥翳汨犷玳铉箝珙犰骘麒殪瀣磲脲铒翦镦犰翦躅轳蹂箝珙犰疳趑弪铙秕箦瀣犷翳孱黩轸滹黝箝铉戾骘躜溟玳秕麴豸鲠祯秕瘐戾轭瘐舂阵轭翳箝珙犰疳趑弪铙秕箬秕熹忮徕戾麸黠螂秕麒殂疳趑弪泔蝌弩痫钿麸麒殂溟玳舢骑屮犴痨瀣桢蝈轶麒狒秕黹玷箦轭箝铉戾孱趄轭秕铒翦蠛徙邃珂沅驸玢滏驸汜溽沐驷怃沅骁邂遽驸汜珏溻徕沅驽驺徜沅驽沅忉裴汨孱趄泔铙轶趔镦翦躅轳蹂箝珙犰疳趑弪铙溴扉黹翦颥犷骈钺祆翳骘躜溟玳秕麴豸鲠祯瀹组翳轭犷孱趄翳筢礤鏖蝈箦珥孱泔铑邈糸镱狎躞邃ㄢ豸秕滹瞌腩秣麒狒翳泔铑邈糸镱徙趱犰禊狎濠澡躅轳蹂箝珙犰疳趑弪铙泔蝌弩痫钿麸翳翦溟骀弪孱麽翳篚忭狎轭趄殄麸蝈钿弪溟玳躞轭翳沲蝌孱鏖蝈箦珥孱泔铑邈糸镱螽洛汜躞轶翳镱禊溟玳翳狒躞弩翳蝈箦珥孱趔溽轭翳徕秭屮犴痨礤犷翳狒麸蝈钿弪番箝珙犰扉铄洮岈犷狎镱洛汜躞轶翳镱禊溟玳翳狒躞弩骘躜箦珥孱趔遽驸礤犷翳狒麸蝈钿弪船箝珙犰扉铄瀣岈娆犷狎镱阵轭翳轶轭骘蝽狒轱瞵秕箬秕熹忮徕戾麸黠螂秕麒殂泔礅轭狒轱镦箝珙犰鏖蝈泔蝌弩痫钿麸遽汨镦翳翦溟玳趔澡孱秕汜溴泔溴翳骘躜溟玳秕麴豸鲠祯瀹疹骘螋躅狒屐轭翳徕秭屮犴痨瀣犰镦翳溟玳趔轭翳秕麴豸鲠祯ㄣ滏邂驺徜沅驽沅忉姗躞骈鲥箦珥孱趔犷狎盹蝈溟骀殂蹯麸溴漉沐骑铒鳜骘沲镱翳遽簌溟玳趔蔑铙殇弪翳轶灬蜱弪屮犴痨搴忮沔忮玑汊溏彐骁徨沅沌邂驿沌徵邂驿驽沅驷忏邃驿玑汊沐驿沐驸玟玢忮邃怄玑忮玢汊玢玢徜邂驸玟徙忡驿徕沅珂汊邃珂邈驺珏溻沌溏邂徙玢骁徨怃沌怃徨玟徭徵忏驿玟汊彐忡汜珂徙玢沅玑忮沌沌驿汜玮汊驸彗沅汊徜沐驸溽珏徭汊忏徨驿邈溽骁溴汜驺溻彗彐徕沅沐溻玑滏邈汊徨汊驿驸珂忉驽溻彐驺珏玢忮驺徨玮溏沐徕驺怃玑珏沔彗溷徕忡怄珏骁遽汜徭沐忡怃徙驽沔徨溏玢驿忉邈怄徜彗忉骁徙珏怃沔邈忉汜驷溴玢溻沔骁怃彗汜骁邈徨玮滏邈滏徕驸邃溽沌玟沐怄珂沐骁溷忮驺珏玮汜滏怃驽玢汊彗徭珏汊滏汜珏怃徙邃忮滏沐徜汊彐珏忏邃忏玑驽沅玮汊珏彗徜驸沅怄彗沐玟驽汜沌玮溴驺沌骁沅徕彗驿怄沐玮滏汜忡沌沌玢徭玢溷徨怄邈徵珂徕沅彗玑彐汜驸珏驿忉驽玮溷骁徨沔玑骁忉玢洛汜躞翳溟玳趔爆船番犷遽汨躞躅轳蹂铛礅弪镦箦珥孱趔秕箬秕熹忮徕戾麸翦祆麒殂泔礅轭狒轱铙镦箝珙犰泔蝌弩痫钿麸翳矬溟玳趔蔑躅糸铉镱禊溟玳趔轭翳秕麴豸鲠祯弩翳疳螋徭翦镱遽汨扉铄┈轭翳徕秭屮犴痨瀣翳弪狎捕轭篝犷沐镦溟玳趔翳狒躞躅轳蹂铛礅弪镦箦珥孱趔ㄨ殓桁殓梏邃徕秭濠深翳秕麴豸鲠祯弩栾磲铢糸礤滹溟玳趔爆船番矧狃疱狎ㄤ彐躅涓鸨ī祜镳骘孱趄轭ㄤ腑溽翎篚祜镳骘骝镯卑忮祜贝骘箦珥孱ㄡ蝈孱趄椹骘箝珙犰祜镳骘骝镯忮祜泔躅祜玑钿箦珥孱ㄡ箬瞟┅泔躅矧箝珙犰博箝珙犰畅箝珙犰穿箝珙犰珐┅┅换令篦弪嘲