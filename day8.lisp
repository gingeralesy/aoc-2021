#|
This file is a part of aoc-2021
(c) 2021 Janne Pakarinen (gingeralesy@gmail.com)
Author: Janne Pakarinen <gingeralesy@gmail.com>
|#

(in-package #:aoc-2021)

(defparameter *day8-input* (local-file #P"day8.txt" :error T))

(defun d8-ch-to-signal (ch)
  "Converts the individual code character into its signal value."
  (ecase ch (#\a 1) (#\b 2) (#\c 4) (#\d 8) (#\e 16) (#\f 32) (#\g 64)))

(defun d8-signal-to-ch (number)
  "Converts the individual code character's signal value into its character."
  (ecase number (0 NIL) (1 #\a) (2 #\b) (4 #\c) (8 #\d) (16 #\e) (32 #\f) (64 #\g)))

(defun d8-code-to-signal (code)
  "Converts a code to its signal value."
  (loop with segment = 0
        for ch across code
        do (incf segment (d8-ch-to-signal ch))
        finally (return (logand segment #x7f))))

(defun d8-signal-to-code (number)
  "Converts a signal value to its code."
  (loop for n from 0 below 7
        for ch = (d8-signal-to-ch (logand number (ash 1 n)))
        when ch collect ch into characters
        finally (return (format NIL "泾汨狎徙翦蝮┅┅ㄤ彐躅涓溽翎ī⒁弭躜铙扉篝镦孱趄殄麒弪遽汨孱趄轶犷狎蜥镦翦箝珙犰镱骘遽汨溟玳衄犷骘躜泔溴麸箫祧瀹鏖翳镳孱骈戾篝蝈犴溽腑轭瘐舄洪姝滹弩铒舡屮轶哄蝌矧戾è筱犷铄ㄣ飙痧泸搴泸遽翦筱犷铄④荀┅祜镳骘扉铄蝈徜扉铄篝蝈犴紊泰骘孱趄磲脲狎蜥贝哄戾礤铘豉疱Ж躅箝珙邃怡翦珐洪铋糸犰屐屙孱癌骘泔躅麒殪扉铄滹ㄣ飙痧泸搴滹磲翥桢蟓狍篝蜷铉磲翥筱犷铄扉铄箦翩ㄡ蝈孱趄泔躅舂ㄤ腑泔溴麸箝珙犰磲翥瑭ㄩ钽泔躅舂泔祆邈孱趄轭麸鲠祯弩骈钺祆蝈趱蝾鲠祯弩┅┅｜尼负渝鲥渝珥孱渝狎汨亠忉蝈禊蝈徙翳筢驽豉镦翳汜鲥麒孱翳麒犰箜狍桢轭麸翳汜鲥盹豸璎泔祆狃箝铉轸渝铙矧轭溟汜翦犷雉桢屮轸麸翳轶汜鲥狒眭汨珧遽翦溴痿璎箫秕栳鲥铒汨镩沐怩麸痱弩镱馏秕篚忭狎轭箪秣禊磲脲轸麽翳蝻蹒翳汜鲥簌篝屙秕铒糸沐翳狒翳骘躜溟玳箦鲥瞽箦珥孱溟箴灬轭秕篚忭狎轭狎磲戽躅泗轱铋铉翳妁眭篝栳鲥忮孱溽磲珏漉蜷铉翳弩汜疱亠酾祆忮轭祜镦趄秕忪鏖翳秕翳屙箫秕т忮趑弪骈珲蝈秕麒狒黩镱绠裴汨溟玳镦箦鲥瞽箦珥孱溟箴灬轶蝈钿弪邃怡趱蝾轭镱矧镦犷镦箦鲥箦珥孱趔钺礤翳蝻蹒绾昂焙埠澈春後後後後後後滗滗滗滗滗滗珑珑珑珑珑珑岛逗泛负购後後後後後後後後後後滗滗滗滗滗滗滗滗珑珑珑珑珑珑珑珑语麸蝈钿弪爆镱禊箦珥孱趔犷黠蹯忮趱蝾邃镱翳蝈篝黠蹯忮镦娈燥蝈钿弪番镱禊箦珥孱趔岈悻犷黠蹯忮趱蝾邃镱澡痱镡戾轶翳狒翳箝珙犰麒殂泔铘蝻翳箦珥孱趔栳鲥忮孱黹邃躔镱遽汨溟箴灬澡篚忭狎轭轶篝殪趄轭麸溟箴灬铛礅弪怡痱镤蹉轭秕麴豸镱箝珙犰鏖蝈翳蝻蹒绗怩翳矬鏖蝈狎泔铑邈翦麸箦珥孱趔蜥钿镯禊罪蝮瀣翳鏖蝈箦珥孱泔铑邈糸镱狎黹邃躔箦疳蜥翦禊骘遽汨骘躜溟玳溟箴灬领镦翳溟玳趔鏖翳轭溟箴灬躞翳筢礤泔铑邈糸镱蟋翳秕玷语秕黹玷腩秣翳狒镱禊箝珙犰鏖蝈犷狎趱蝾邃镱怩翳狒滹弩瞌礤犷箦珥孱趔犷狎趱蝾邃镱翳镱禊溟玳翳狒躞弩赭箦珥孱趔轶爆箫轸眭篝礤犷箦珥孱趔犷狎礤犷麸忮镱组翳牾篝翳狒轭骘蝽狒轱瞵秕篝殪汜瞌翦祆麒殂鏖蝈ㄢ绌顼弩麸麒殂箦珥孱ㄣ姗骑翳狒秕ъ铄邃麸泔祆邈盹蝈轭骘蝽狒轱町骑遽汨溟箴灬秕麽翥翳汨犷玳铉箝珙犰骘麒殪瀣磲脲铒翦镦犰翦躅轳蹂箝珙犰疳趑弪铙秕箦瀣犷翳孱黩轸滹黝箝铉戾骘躜溟玳秕麴豸鲠祯秕瘐戾轭瘐舂阵轭翳箝珙犰疳趑弪铙秕箬秕熹忮徕戾麸黠螂秕麒殂疳趑弪泔蝌弩痫钿麸麒殂溟玳舢骑屮犴痨瀣桢蝈轶麒狒秕黹玷箦轭箝铉戾孱趄轭秕铒翦蠛徙邃珂沅驸玢滏驸汜溽沐驷怃沅骁邂遽驸汜珏溻徕沅驽驺徜沅驽沅忉裴汨孱趄泔铙轶趔镦翦躅轳蹂箝珙犰疳趑弪铙溴扉黹翦颥犷骈钺祆翳骘躜溟玳秕麴豸鲠祯瀹组翳轭犷孱趄翳筢礤鏖蝈箦珥孱泔铑邈糸镱狎躞邃ㄢ豸秕滹瞌腩秣麒狒翳泔铑邈糸镱徙趱犰禊狎濠澡躅轳蹂箝珙犰疳趑弪铙泔蝌弩痫钿麸翳翦溟骀弪孱麽翳篚忭狎轭趄殄麸蝈钿弪溟玳躞轭翳沲蝌孱鏖蝈箦珥孱泔铑邈糸镱螽洛汜躞轶翳镱禊溟玳翳狒躞弩翳蝈箦珥孱趔溽轭翳徕秭屮犴痨礤犷翳狒麸蝈钿弪番箝珙犰扉铄洮岈犷狎镱洛汜躞轶翳镱禊溟玳翳狒躞弩骘躜箦珥孱趔遽驸礤犷翳狒麸蝈钿弪船箝珙犰扉铄瀣岈娆犷狎镱阵轭翳轶轭骘蝽狒轱瞵秕箬秕熹忮徕戾麸黠螂秕麒殂泔礅轭狒轱镦箝珙犰鏖蝈泔蝌弩痫钿麸遽汨镦翳翦溟玳趔澡孱秕汜溴泔溴翳骘躜溟玳秕麴豸鲠祯瀹疹骘螋躅狒屐轭翳徕秭屮犴痨瀣犰镦翳溟玳趔轭翳秕麴豸鲠祯ㄣ滏邂驺徜沅驽沅忉姗躞骈鲥箦珥孱趔犷狎盹蝈溟骀殂蹯麸溴漉沐骑铒鳜骘沲镱翳遽簌溟玳趔蔑铙殇弪翳轶灬蜱弪屮犴痨搴忮沔忮玑汊溏彐骁徨沅沌邂驿沌徵邂驿驽沅驷忏邃驿玑汊沐驿沐驸玟玢忮邃怄玑忮玢汊玢玢徜邂驸玟徙忡驿徕沅珂汊邃珂邈驺珏溻沌溏邂徙玢骁徨怃沌怃徨玟徭徵忏驿玟汊彐忡汜珂徙玢沅玑忮沌沌驿汜玮汊驸彗沅汊徜沐驸溽珏徭汊忏徨驿邈溽骁溴汜驺溻彗彐徕沅沐溻玑滏邈汊徨汊驿驸珂忉驽溻彐驺珏玢忮驺徨玮溏沐徕驺怃玑珏沔彗溷徕忡怄珏骁遽汜徭沐忡怃徙驽沔徨溏玢驿忉邈怄徜彗忉骁徙珏怃沔邈忉汜驷溴玢溻沔骁怃彗汜骁邈徨玮滏邈滏徕驸邃溽沌玟沐怄珂沐骁溷忮驺珏玮汜滏怃驽玢汊彗徭珏汊滏汜珏怃徙邃忮滏沐徜汊彐珏忏邃忏玑驽沅玮汊珏彗徜驸沅怄彗沐玟驽汜沌玮溴驺沌骁沅徕彗驿怄沐玮滏汜忡沌沌玢徭玢溷徨怄邈徵珂徕沅彗玑彐汜驸珏驿忉驽玮溷骁徨沔玑骁忉玢洛汜躞翳溟玳趔爆船番犷遽汨躞躅轳蹂铛礅弪镦箦珥孱趔秕箬秕熹忮徕戾麸翦祆麒殂泔礅轭狒轱铙镦箝珙犰泔蝌弩痫钿麸翳矬溟玳趔蔑躅糸铉镱禊溟玳趔轭翳秕麴豸鲠祯弩翳疳螋徭翦镱遽汨扉铄┈轭翳徕秭屮犴痨瀣翳弪狎捕轭篝犷沐镦溟玳趔翳狒躞躅轳蹂铛礅弪镦箦珥孱趔ㄨ殓桁殓梏邃徕秭濠深翳秕麴豸鲠祯弩栾磲铢糸礤滹溟玳趔爆船番矧狃疱狎ㄤ彐躅涓泔躅舡徙糸鲥鲠祯濠祜镳骘骝镯忮祜泔躅祜玑钿鲠祯ㄡ箬瞟┅┅ㄤ彐躅涓鸨ī祜镳骘孱趄轭ㄤ腑溽翎篚祜镳骘骝镯卑忮祜贝骘箦珥孱ㄡ蝈孱趄椹骘箝珙犰ㄤ腑泔躅舡徙糸鲥箦珥孱舂泔躅矧箝珙犰博箝珙犰畅箝珙犰穿箝珙犰珐┅┅换令篦弪嘲｜嗅螋憎澡蝻蹒扉趑戾溴漉泗轱瞵秕箬秕熹铒忮徕戾麸溴翦蝽轭翳蝈磲轭轭溟玳趔蔑铙殇弪徵衢翳骈蝮屮犴痨徕秭搴徙邃珂沅驸玢滏驸汜溽沐驷怃沅骁邂遽驸汜珏溻徕沅驽驺徜沅驽沅忉伶翦箫礤汜蝈骢犷犰箝蟋翳磲痧轭忮赭邋箝珙犰鏖蝈犷箦珥孱趔镱禊磲脲箦铙轭翳骘祆秣轭泔铈殓躜狒轱詈滗滗骀骀沣沣语翳躅轳蹂箝珙犰疳趑弪铙黠蹯泔蝌弩痫钿麸翳骘祆秣轭溟玳趔徙邃珂夂沅驸搴玢滏岷驸汜浜溽夂沐驷怃沅骁邂遽驸汜珏溻徕澡孱翳骘躜溟玳趔镦翳秕麴豸鲠祯汜忮溴泔溴浜沅驽夂驺徜夂沅驽夂沅忉婧澡弪彐矧瀣翳秕麴豸鲠祯骘翳轶孱趄轶党党骑祆秣轭翳轶筢礤痱镢弩骘遽汨孱趄轭翳箦泔钿灬蜱弪屮犴痨徕秭瀣翳秕麴豸鲠祯镦遽汨孱趄汜忮溴翦蝽轭邃驿玑汊沐驿沐驸玟玢忮赋勾驺珏溻沌溏邂徙玢狗副沌沌驿汜玮汊绾北狗彐徕沅沐溻玑滏邈汊钩侗珏沔彗溷徕忡怄珏岷锤烦珏怃沔邈忉汜驷溴玢夂复备沐骁溷忮驺珏玮汜滏搴吹锤邃忏玑驽沅玮汊珏婧倍驳玮滏汜忡沌沌夂阜狈骁徨沔玑骁忉玢搴闯钡龄溟铉犰镦翳秕麴豸鲠祯弩轭翳轶灬蜱弪屮犴痨痱镤蹉弩侗膊巩骑遽汨孱趄溴翦蝽轭犰镦翳鏖蝈箦珥孱泔铑邈糸镱犷溴泔溴翳骘躜溟玳秕麴豸鲠祯弩阻狒滹秕珏殒秕徜躔犰镦翳秕麴豸鲠祯弩ㄤ彐躅涓箫祧ㄥ铘蝙⒃栝轶翳箝祆箫祯糸镱麒弪麇溴漉沐弼弪翳轭篝屦怡篝屦换韵南澡泔镬箫祯糸镱麒弪麇趄狯弪箦趄邋镦痫篌殁殪轸殄螽戾è溟玳舡箝珙犰磲脲狎蜥卑哄戾礤铘豉疱Ж躅箝珙邃怡翦珐洪铋糸犰屐屙孱癌ㄤ殓轸箝溴磲脲狎蜥哄戾礤铘豉疱Ж躅箝珙邃怡翦珐洪铋糸犰屐屙孱癌┅灬忮祗è珏舡箝珙犰铛礅弪ㄡ蝈溟玳舡箝珙犰铛礅弪┅箦舡箝珙犰铛礅弪鲠祯濠戾è鲠祯祜玑钿鲠祯ｘ锋┅祜镳骘骝镯躅糸鲠祯ㄡ蝈孱趄瞟麒孱卑瞟滹ㄥ蝌矧⑸铞犰殇箝珙犰幄鲠祯濠箦翩ㄡ蝈溟玳舡箝珙犰铛礅弪鲠祯濠┅ㄧ弭箝溴轭溴箝溴ㄥ汜箦箝溴ê麸癌ê麸瓠戾骠暴ê麸瓠蜷玷博ê黹滗戾畅ê怙趑镯戾骠穿ê怙趑镯蜷玷旦ê怙趑镯订┅ㄧ弭箝溴箝溴戾è鲠祯ㄡ蝈溟玳舡箝溴ㄧ弭箝溴轭溴箝溴┅┅躅戾篌鲠祯濠ㄥ蝌矧⒂殇铒骘躅弭幄箝溴┅鲠祯濠ㄧ弭箝溴箝溴蝈篝箝溴螬戾è鲠祯ㄧ弭箝溴箝溴┅祜镳骘犷雉桢轭箝溴滹ㄩ钽鲠祯ㄧ弭箝溴犷雉桢颟┅鲠祯濠箦舡箝溴箝溴鲠祯濠戾è鲠祯祜玑钿鲠祯ｘ锋┅躅戾篌ㄤ腑泔躅舡徙糸鲥鲠祯濠ㄥ蝌矧⑸铞犰殇箝溴鲠祯搴幄箝溴鲠祯濠箦翩ㄡ蝈溟玳舡箝溴ㄧ弭箝溴轭溴箝溴┅鲠祯濠┅换碑崎钿爆船番犷府祜镳骘骝镯忮祜卑骘箝珙犰ㄡ蝈孱趄瞟骘徙糸鲥ㄤ腑泔躅舡徙糸鲥箝珙犰滹ㄣ狍徙糸鲥ú箦舡箝珙犰箝珙犰┅ù箦舡箝珙犰箝珙犰┅ǔ箦舡箝珙犰箝珙犰┅ǚ箦舡箝珙犰箝珙犰┅┅换族栳鲥箝珙犰蠛换族栳鲥箝溴换伯蔑眇狎犷麸骈钿翳麸甬箦舡箝溴呼镳祜瑛矧ㄧ弭箝珙犰暴ㄧ弭箝珙犰珐┅换族栳鲥箝珙犰蠛换族栳鲥箝溴麸换钞阵犷翳麸麸骈钿巩换镱禊栳镱屮趄岈麒殂轶翳怙趑镯换澡黹篌轭镱骝镯轶怙趑镯戾骠祜镳骘骝镯忮祜卑骘铋铄ㄡ蝈孱趄瞟躅糸ㄧ弭箝珙犰供麒孱ㄤ腑泔躅舡徙糸鲥铋铄┅滹戾è骘躜麸祜玳矧ㄧ弭箝珙犰穿ㄧ弭箝溴呼镳┅┅麒孱ㄤ腑泔躅舡徙糸鲥祜瑛矧骘躜麸铋铄┅箦舡箝珙犰铋铄箦舡箝溴衡雉麸祜瑛矧骘躜麸铋铄┅箦舡箝溴衡雉麸憝戾骠祜珙雉铋铄┅┅换族栳鲥箝珙犰蠛换族栳鲥箝溴麸怙趑镯戾骠怙趑镯换串怙趑镯箫礤雉桢翳狒轶黹钞换组翳黹滗戾犷彘玷麇汜珏弪锂祜镳骘骝镯忮祜卑骘翳蝈ㄡ蝈孱趄瞟躅糸ㄧ弭箝珙犰畅麒孱ㄤ腑泔躅舡徙糸鲥翳蝈濠滹戾è箦鲥瞽怙趑镯祜玳矧ㄧ弭箝珙犰珐ㄧ弭箝溴衡雉麸愆┅麒孱ㄤ腑泔躅舡徙糸鲥祜瑛矧箦鲥瞽怙趑镯翳蝈濠┅箦舡箝珙犰翳蝈濠箦舡箝溴喉殇潇祜瑛矧箦鲥瞽怙趑镯翳蝈濠箦舡箝珙犰祜瑛矧ㄧ弭箝珙犰俯ㄧ弭箝溴喉殇潇濠┅┅换族栳鲥箝珙犰蠛换族栳鲥箝溴麸黹滗戾怙趑镯戾骠怙趑镯换诞燥黹怙趑镯怙趑镯戾骠箫礤雉桢铂箫礤雉桢轶麸瓠蜷玷舢换燥蜷玷犷镱蝈鲥犰怙趑镯蜷玷舢祜镳骘骝镯忮祜卑骘赭ㄡ蝈孱趄瞟躅糸ㄧ弭箝珙犰博麒孱ㄤ腑泔躅舡徙糸鲥赭铹滹戾è舡憝猸忪ㄧ弭箝溴呼镳喉殇潇衡雉麸衡雉麸憝戾骠┅麒孱ㄤ腑泔躅舡徙糸鲥祜瑛矧舡憝猸忪赭铹┅箦舡箝珙犰赭铹箦舡箝溴呼镳蜷玷祜瑛矧舡憝猸忪赭铹箦舡箝溴衡雉麸憝蜷玷祜瑛矧ㄧ弭箝溴呼镳蜷玷舂ㄧ弭箝珙犰暴┅┅换族栳鲥箝珙犰蠛换族栳鲥箝溴麸麸瓠蜷玷黹滗戾怙趑镯戾骠怙趑镯蜷玷怙趑镯换懂义篝麇汜溴漉沐ū黹洎麸瓠戾骠换令翳孱麇汜牾篝怩殪铛礅弪骈鲥戾è镱瀛黹祜玳矧ㄧ弭箝珙犰暴ㄧ弭箝溴喉殇潇濠┅箦舡箝溴呼镳戾骠祜瑛矧ㄧ弭箝珙犰穿镱瀛黹洎┅箦舡箝珙犰ㄧ弭箝溴呼镳呼镳戾骠喉殇潇衡雉麸憝蜷玷衡雉麸愆箦舡箝珙犰祜瑛矧ㄧ弭箝珙犰俯ㄧ弭箝溴呼镳蜷玷舂┅换族栳鲥箝珙犰蠛换娘铄换族栳鲥箝溴麸麸瓠戾骠麸瓠蜷玷黹滗戾怙趑镯戾骠怙趑镯蜷玷怙趑镯换娘铄戾è铛礅弪癌ㄤ雉轫弩ㄩ穿祜镳鏖翳溟玳ㄡ蝈孱趄ǐ卑┅骘骝镯麒殪ǒ溟玳ㄧ弭箝珙犰瞟骈钺祆ㄩ钽铛礅弪íǒ卑鞍ㄥ痿卑椹瞟┅铛礅弪┅┅ㄤ彐躅涓鸩ī祜镳骘孱趄轭ㄤ腑溽翎篚ㄤ腑箫祧孱趄┅换令篦弪拱赴斗